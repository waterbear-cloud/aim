<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <title tal:content="'Paco project: ' + project.title"></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="">
  <meta property="og:type" content="">
  <meta property="og:url" content="">
  <meta property="og:image" content="">

  <link href='http://fonts.googleapis.com/css?family=Raleway:400,300,600' rel='stylesheet' type='text/css'>

  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/skeleton.css">
  <link rel="stylesheet" href="css/paco.css">

  <meta name="theme-color" content="#fafafa">
</head>

<body>

  <div class="container">
    <section class="header">
      <h4 class="title">Paco Project:</h4>
      <h2 class="title" tal:content="project.title_or_name"></h2>
    </section>

    <div class="navbar-spacer"></div>
    <nav class="navbar">
      <div class="container">
        <ul class="navbar-list">
          <li class="navbar-item">
            <a class="navbar-link" href="#accounts">Accounts</a>
          </li>
          <li class="navbar-item">
            <a class="navbar-link" href="#netenvs">Network Environments</a>
          </li>
          <li class="navbar-item">
            <a class="navbar-link" href="#global">Global Resources</a>
          </li>
        </ul>
      </div>
    </nav>
    <div class="navbar-spacer"></div>

    <div id="accounts">
      <h6 class="section-header">Accounts</h6>
      <table class="u-full-width">
        <thead>
          <tr>
            <th>Account</th>
            <th>Switch-Role Login</th>
            <th>Default Region</th>
          </tr>
        </thead>
        <tbody>
          <tr tal:repeat="account project.accounts.values()">
            <td tal:content="account.title">title</td>
            <td><a tal:attributes="href f'https://signin.aws.amazon.com/switchrole?roleName={userinfo.admin_iam_role_name}&account={account.account_id}&color=008080&displayName={account.title}'">AWS Account Login</a></td>
            <td tal:content="account.region">region</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div id="netenvs">
      <h6 class="section-header">Network Environments</h6>
      <table class="u-full-width">
        <thead>
          <tr>
            <th>Name</th>
          </tr>
        </thead>
        <tbody>
          <div tal:repeat="netenv project.netenv.values()">
            <tr>
              <td tal:content="netenv.title_or_name">name</td>
            </tr>
            <tr>
              <td>
                <table class="u-full-width">
                  <thead>
                    <tr>
                      <th style="max-width: 20rem;">Environments</th>
                      <th>Deployable Regions</th>
                    </tr>
                    <tr tal:repeat="env netenv.values()">
                      <td>
                        <a tal:content="env.title_or_name" tal:attributes="href f'ne-{netenv.name}-{env.name}.html'">env</a>
                      </td>
                      <td>
                        <ul class="res-list">
                          <li class="res-item" tal:repeat="env_reg env.env_regions.values()">
                            <div class="list-header"><b>Region:</b> ${env_reg.name}</div>

                            <table class="u-full-width">
                              <thead>
                                <tr>
                                  <th>Environment Resources</th>
                                  <th>Applications</th>
                                </tr>
                              </thead>
                              <tr>
                                <td>
                                  <div class="list-header"><b>Network</b></div>
                                  <ul class="sub-list">
                                    <li class="sub-item"><b>Availability Zones:</b> ${env_reg.network.availability_zones}</li>
                                    <li tal:condition="env_reg.network.vpc" class="sub-item"><b>VPC:</b> ${env_reg.network.vpc.is_enabled()}</li>
                                    <li tal:condition="env_reg.network.vpc.segments" class="sub-item"><b>Segments:</b> ${', '.join(env_reg.network.vpc.segments.keys())}</li>
                                  </ul>
                                  <div tal:condition="env_reg.backup_vaults" class="list-header"><b>Backup Vaults</b></div>
                                  <ul tal:condition="env_reg.backup_vaults" class="sub-list">
                                    <li class="sub-item" tal:repeat="vault env_reg.backup_vaults.values()"><b>Vault:</b> ${vault.title_or_name}</li>
                                  </ul>
                                  <div tal:condition="env_reg.secrets_manager" class="list-header"><b>Secrets Manager</b></div>
                                  <ul tal:condition="env_reg.secrets_manager" class="sub-list">
                                    <li class="sub-item" tal:repeat="sm env_reg.secrets_manager.values()"><b>Secret Manager:</b> ${sm.title_or_name}</li>
                                  </ul>
                                </td>
                                <td>
                                  <ul class="sub-list">
                                    <li tal:repeat="app env_reg.applications.values()" class="sub-item"><b>Application:</b> ${app.title_or_name}</li>
                                  </ul>
                                </td>
                              </tr>
                            </table>
                          </li>
                        </ul>
                      </td>
                    </tr>
                  </thead>
                </table>
              </td>
            </tr>
          </div>
        </tbody>
      </table>
    </div>
    <div id="global">
      <h6 class="section-header">Global Resources</h6>
      <p class="description">AWS Resources that are available at the account-level.</p>
      <h6 class="resource-header">IAM Users</h6>
      <p class="resource-description">IAM Users are AWS login accounts. Paco creates IAM Users that enforce multi-factor authentication (MFA) and creates IAM Roles
        for every account the User has access to. To gain the Users permissions, it's necessary to first assume the role in the target account.
        <a href="https://www.paco-cloud.io/en/latest/yaml-global-resources.html#iamuser">Paco docs &raquo;</a></p>
      <p tal:condition="len(project.resource.iam.users.values()) == 0">No IAM Users declared.</p>
      <table class="u-full-width" tal:condition="len(project.resource.iam.users.values()) > 0">
        <thead>
          <tr>
            <th>Username</th>
            <th>User Account</th>
            <th>Accounts</th>
            <th>Console access?</th>
            <th>API access?</th>
            <th style="min-width: 200px;">Permissions</th>
          </tr>
        </thead>
        <tbody>
          <tr tal:repeat="user project.resource.iam.users.values()">
            <td>
              <p class="technical" tal:content="user.username">username</p>
              <p tal:content="user.description">description</p>
            </td>
            <td tal:content="resolve_ref(user.account).title_or_name">account</td>
            <td tal:content="', '.join(user.account_whitelist)">account_whitelist</td>
            <td>
              <span tal:condition="user.console_access_enabled">Yes</span>
              <span tal:condition="not user.console_access_enabled">No</span>
            </td>
            <td>
              <span tal:condition="user.programmatic_access">Yes</span>
              <span tal:condition="not user.programmatic_access">No</span>
            </td>
            <td>
              <ul class="res-list" tal:repeat="perm user.permissions.values()">
                <li class="res-item" metal:use-macro="templates['iam.pt'].macros.permission">
                </li>
              </ul>
            </td>
          </tr>
        </tbody>
      </table>

      <h6 class="resource-header">CloudTrail</h6>
      <p class="resource-description">CloudTrail logs AWS API calls. Monitor and react to changes in your AWS accounts with CloudTrail.
        Paco can configure CloudTrails to report to a centralized S3 Bucket for archival, and to a central CloudWatch LogGroup for
        easier querying of the CloudTrail logs.
        <a href="https://www.paco-cloud.io/en/latest/yaml-global-resources.html#cloudtrail">Paco docs &raquo;</a></p>

      <p tal:condition="len(project.resource.cloudtrail.trails.values()) == 0">No CloudTrail declared.</p>
      <table class="u-full-width" tal:condition="len(project.resource.cloudtrail.trails.values()) > 0">
        <thead>
          <tr>
            <th>Name</th>
            <th>Account</th>
            <th>S3 Bucket Prefix</th>
          </tr>
        </thead>
        <tbody>
          <tr tal:repeat="ct project.resource.cloudtrail.trails.values()">
            <td tal:content="ct.title_or_name">
            </td>
            <td tal:content="resolve_ref(ct.s3_bucket_account).title_or_name">account</td>
            <td tal:content="ct.s3_key_prefix">s3_key_prefix</td>
          </tr>
        </tbody>
      </table>

      <h6 class="resource-header">CodeCommit</h6>
      <p class="resource-description">CodeCommit hosts Git repositories. These repositories are secured within your AWS accounts
        and can be simpler to configure to deploy to a CI/CD than GitHub. Paco creates IAM Users that only have access to
        the specified CodeCommit repos and can only be authenticated using an SSH public key.
        <a href="https://www.paco-cloud.io/en/latest/yaml-global-resources.html#codecommit">Paco docs &raquo;</a></p>

      <p tal:condition="len(project.resource.codecommit.values()) == 0">No CodeCommit declared.</p>
      <table class="u-full-width" tal:condition="len(project.resource.codecommit.values()) > 0">
        <thead>
          <tr>
            <th>Repository Name</th>
            <th>Location</th>
            <th>Users</th>
          </tr>
        </thead>
        <tbody>
          <tr tal:repeat="repo project.resource.codecommit.repo_list()">
            <td>
              <p class="technical" tal:content="repo.repository_name">repository_name</p>
              <p tal:content="repo.description">description</p>
            </td>
            <td>
              <p tal:content="resolve_ref(repo.account).title_or_name">account</p>
              <p tal:content="repo.region">region</p>
            </td>
            <td>
              <ul class="sub-list">
                <li class="sub-item" tal:repeat="user repo.users.values()">${user.username}</li>
              </ul>
            </td>
          </tr>
        </tbody>
      </table>

      <h6 class="resource-header">SNS Topics</h6>
      <p class="resource-description">SNS Topics are where notifications can be sent. Paco will configure
        alarms to notify to these SNS Topics.
        <a href="https://www.paco-cloud.io/en/latest/yaml-global-resources.html#sns-topics">Paco docs &raquo;</a></p>
      <p tal:condition="len(project.resource.sns.topics.values()) == 0">No SNS Topics declared.</p>
      <table class="u-full-width" tal:condition="len(project.resource.sns.topics.values()) > 0">
        <thead>
          <tr>
            <th>Name</th>
            <th>Locations</th>
            <th>Subscriptions</th>
          </tr>
        </thead>
        <tbody>
          <tr tal:repeat="topic project.resource.sns.topics.values()">
            <td>
              <p class="technical" tal:content="topic.title_or_name">name</p>
            </td>
            <td>
              <ul class="sub-list">
                <li tal:condition="topic.locations != []" class="sub-item" tal:repeat="location topic.locations">
                  <p><b>Account:</b> ${resolve_ref(location.account).title_or_name}</p>
                  <p><b>Region(s):</b> ${', '.join(location.regions)}</p>
                </li>
                <li tal:condition="topic.locations == []" class="sub-item" tal:repeat="location project.resource.sns.default_locations">
                  <p><b>Account:</b> ${resolve_ref(location.account).title_or_name}</p>
                  <p><b>Region(s):</b> ${', '.join(location.regions)}</p>
                </li>
              </ul>
            </td>
            <td>
              <ul class="sub-list">
                <li class="sub-item" tal:repeat="sub topic.subscriptions">
                  <p><b>Endpoint:</b> ${sub.endpoint}</p>
                  <p><b>Protocol:</b> ${sub.endpoint}</p>
                </li>
              </ul>
            </td>
          </tr>
        </tbody>
      </table>

    </div>
  </div>

</body>
</html>
